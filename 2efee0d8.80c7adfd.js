(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{155:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return d}));var a=n(1),r=n(9),i=(n(0),n(216)),c={sidebar_label:"Overview",title:"Container call"},o={id:"reference/opspec/op.yml/call/container/index",title:"Container call",description:"A container call is an object defining how to run a container. Container calls are an abstraction on top of a concrete container running tool like docker or kubernetes that have a more strictly typed interface.",source:"@site/docs/reference/opspec/op.yml/call/container/index.md",permalink:"/docs/reference/opspec/op.yml/call/container/index",editUrl:"https://github.com/opctl/opctl/edit/master/website/docs/reference/opspec/op.yml/call/container/index.md",lastUpdatedBy:"Cameron Little",lastUpdatedAt:1617200902,sidebar_label:"Overview",sidebar:"docs",previous:{title:"Call",permalink:"/docs/reference/opspec/op.yml/call/index"},next:{title:"Image",permalink:"/docs/reference/opspec/op.yml/call/container/image"}},l=[{value:"Properties",id:"properties",children:[{value:"<code>image</code>",id:"image",children:[]},{value:"<code>cmd</code>",id:"cmd",children:[]},{value:"<code>dirs</code>",id:"dirs",children:[]},{value:"<code>envVars</code>",id:"envvars",children:[]},{value:"<code>files</code>",id:"files",children:[]},{value:"<code>name</code>",id:"name",children:[]},{value:"<code>ports</code>",id:"ports",children:[]},{value:"<code>sockets</code>",id:"sockets",children:[]},{value:"<code>workDir</code>",id:"workdir",children:[]}]}],b={rightToc:l},p="wrapper";function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)(p,Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"A container call is an object defining how to run a container. Container calls are an abstraction on top of a concrete container running tool like docker or kubernetes that have a more strictly typed interface."),Object(i.b)("h2",{id:"properties"},"Properties"),Object(i.b)("h3",{id:"image"},Object(i.b)("inlineCode",{parentName:"h3"},"image")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"required")),Object(i.b)("p",null,"A container ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/opspec/op.yml/call/container/image"}),"image")," to run."),Object(i.b)("h3",{id:"cmd"},Object(i.b)("inlineCode",{parentName:"h3"},"cmd")),Object(i.b)("p",null,"The binary to run and it's arguments, as an array of ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"../../../types/string"}),"strings"),". This will override the images' default command, if defined. Strings will be interpreted by opctl with variable reference replacements applied."),Object(i.b)("p",null,"The first string in the command can be the name binary available in the container's ",Object(i.b)("inlineCode",{parentName:"p"},"PATH"),", an absolute path to the binary file, or a relative path to the binary file from the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#workdir"}),"working directory")," of the container."),Object(i.b)("p",null,"The remaining strings in the command are passed directly to the binary as individual string arguments."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'cmd: [echo, my string, $(variable)] # "echo" "my string" "valueOfVariable"\n')),Object(i.b)("p",null,"It's important to remember that the command is not run in a shell, which means shell-specific behavior such as piping (",Object(i.b)("inlineCode",{parentName:"p"},"|"),") and redirection (",Object(i.b)("inlineCode",{parentName:"p"},">"),") will not work directly. To use a shell, you can run it as your command:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'cmd:\n  - bash\n  - -c\n  - |\n    # this is a full bash script\n    echo "hello world" > /file\n    cat /file\n')),Object(i.b)("h3",{id:"dirs"},Object(i.b)("inlineCode",{parentName:"h3"},"dirs")),Object(i.b)("p",null,"An object mapping directories to mount within the container. Each key is an absolute path within the container. Values can take several forms:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"value"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"meaning"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"null")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Shorthand to mount a directory embedded in the op.",Object(i.b)("br",null),"For example, ",Object(i.b)("inlineCode",{parentName:"td"},"/relative/path:")," is equivalent to ",Object(i.b)("inlineCode",{parentName:"td"},"/relative/path: $(./relative/path)"),". If the ",Object(i.b)("inlineCode",{parentName:"td"},"op.yml")," is at ",Object(i.b)("inlineCode",{parentName:"td"},"~/ops/foo/op.yml"),", this will mount the directory ",Object(i.b)("inlineCode",{parentName:"td"},"~/ops/foo/relative/path"),".")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/reference/opspec/types/dir#initialization"}),"dir initializer")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The directory is evaluated and created, then mounted")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/reference/opspec/types/dir"}),"dir")," ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/reference/opspec/op.yml/variable-reference"}),"variable reference")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The referenced directory is mounted")))),Object(i.b)("h3",{id:"envvars"},Object(i.b)("inlineCode",{parentName:"h3"},"envVars")),Object(i.b)("p",null,"An ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/opspec/types/object"}),"object")," or ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/opspec/op.yml/variable-reference"}),"variable reference")," mapping environment variable names to values to be set in the container. Value are coerced to strings."),Object(i.b)("h3",{id:"files"},Object(i.b)("inlineCode",{parentName:"h3"},"files")),Object(i.b)("p",null,"An object mapping files to mount within the container. Each key is an absolute path within the container. Values can take several forms:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"value"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"meaning"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("inlineCode",{parentName:"td"},"null")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Shorthand to mount a file embedded in the op.",Object(i.b)("br",null),"For example, ",Object(i.b)("inlineCode",{parentName:"td"},"/relative/path:")," is equivalent to ",Object(i.b)("inlineCode",{parentName:"td"},"/relative/path: $(./relative/path)"),". If the ",Object(i.b)("inlineCode",{parentName:"td"},"op.yml")," is at ",Object(i.b)("inlineCode",{parentName:"td"},"~/ops/foo/op.yml"),", this will mount the file ",Object(i.b)("inlineCode",{parentName:"td"},"~/ops/foo/relative/path"),".")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/reference/opspec/types/file#initialization"}),"file initializer")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The file is evaluated and created, then mounted")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/reference/opspec/types/file"}),"file")," ",Object(i.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/reference/opspec/op.yml/variable-reference"}),"variable reference")),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"The referenced file is mounted")))),Object(i.b)("h3",{id:"name"},Object(i.b)("inlineCode",{parentName:"h3"},"name")),Object(i.b)("p",null,"A ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/opspec/types/string#initialization"}),"string")," defining a name for the container. The container will be resolvable by this name within the opctl network, which allows making http requests between containers by. If multiple containers are given the same name between ",Object(i.b)("em",{parentName:"p"},"any")," ops, requests may be made to any of them."),Object(i.b)("h3",{id:"ports"},Object(i.b)("inlineCode",{parentName:"h3"},"ports")),Object(i.b)("p",null,"An object mapping ports between the container and opctl host. Each key is a container port or range of ports (optionally including protocol) which match the regular expression ",Object(i.b)("inlineCode",{parentName:"p"},"[0-9]+(-[0-9]+)?(tcp|udp)"),". Each value is a corresponding opctl host port or range of ports matching the regular expression ",Object(i.b)("inlineCode",{parentName:"p"},"[0-9]+(-[0-9]+)?"),"."),Object(i.b)("p",null,"For example, you can map the port 80 within a container to your local port 8080:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"ports:\n  80: 8080\n")),Object(i.b)("h3",{id:"sockets"},Object(i.b)("inlineCode",{parentName:"h3"},"sockets")),Object(i.b)("p",null,"An object mapping sockets to mount within the container. Each key is an absolute path within the container. Values are ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/opspec/types/socket"}),"sockets")," or ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"../../variable-reference"}),"variable references")," to a socket to mount."),Object(i.b)("h3",{id:"workdir"},Object(i.b)("inlineCode",{parentName:"h3"},"workDir")),Object(i.b)("p",null,"A ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/reference/opspec/types/string#initialization"}),"string")," defining the absolute path from which ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#cmd"}),"cmd")," will be executed. This will override the images' default working directory, if defined."))}d.isMDXComponent=!0},216:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return u}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),p=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):o({},t,{},e)),n},d=function(e){var t=p(e.components);return(r.a.createElement(b.Provider,{value:t},e.children))},s="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},h=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),d=p(n),s=a,h=d["".concat(c,".").concat(s)]||d[s]||m[s]||i;return n?r.a.createElement(h,o({ref:t},b,{components:n})):r.a.createElement(h,o({ref:t},b))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,c=new Array(i);c[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[s]="string"==typeof e?e:a,c[1]=o;for(var b=2;b<i;b++)c[b]=n[b];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"}}]);